package com.example.spiel;

import javafx.animation.FadeTransition;
import javafx.application.Platform;
import javafx.scene.Scene;
import javafx.scene.layout.*;
import javafx.scene.paint.Color;
import javafx.stage.Stage;
import javafx.util.Duration;

import java.net.MalformedURLException;

/**Diese Klasse verwaltet die komplette
Logik für das Startmenü am Anfang des Spiels*/
public class StartMenu {
    /**
     * The Start root.
     */
    private Pane startRoot;
    /**
     * The Stage.
     */
    private Stage stage;
    /**
     * The Main.
     */
    private Main main;
    /**
     * The Start scene.
     */
    private Scene startScene;
    /**
     * The Game sounds.
     */
    private GameSounds gameSounds = new GameSounds();
    /**
     * The Overlay ui.
     */
    private OverlayUI overlayUI;
    /**
     * The Start menu ui.
     */
    private StartMenuUI startMenuUI = new StartMenuUI();
    /**
     * The Credits sub scene.
     */
    private StartSubScene creditsSubScene;
    /**
     * The Score sub scene.
     */
    private StartSubScene scoreSubScene;
    /**
     * The Help sub scene.
     */
    private StartSubScene helpSubScene;
    /**
     * The Scene to hide.
     */
    private StartSubScene sceneToHide = new StartSubScene();

    /**
     * Instantiates a new Start menu.
     *
     * @param stage the stage
     * @param main  the main
     */
    public StartMenu(Stage stage, Main main) throws MalformedURLException{
        this.stage = stage;
        this.main = main;
        startMenu();

    }

    /**
     * Start menu.
     */
    //initialisiert das Startmenü
    public void startMenu() throws MalformedURLException {
        gameSounds.playStartMusic();
        Pane startBackGroundRoot = new Pane(); // Root für den Hintergrund
        startRoot = new Pane(); // Root für alle anderen Objekte im Startmenue
        StackPane startGroup = new StackPane(startBackGroundRoot, startRoot);
        startScene = new Scene(startGroup);
        overlayUI = new OverlayUI(startBackGroundRoot, startRoot);
        overlayUI.addStartBackground();
        createSubscenes();
        stage.setScene(startScene);
    }

    /**
     * Start game.
     */
    //Startet das Spiel
    private void startGame() {
        gameSounds.stopStartMusic();

        // Fade-Effekt beim Starten des Spiels
        FadeTransition fadeOut = new FadeTransition(Duration.millis(500), startRoot);
        fadeOut.setFromValue(1.0);
        fadeOut.setToValue(0.0);
        fadeOut.setOnFinished(event -> {
            main.startGame();
        });

        fadeOut.play();
    }

    /**
     * Show sub scene.
     *
     * @param startSubscene the start subscene
     */
    //Versteckt die SubScene wieder
    private void showSubScene(StartSubScene startSubscene) {
        if (sceneToHide != null) {
            sceneToHide.moveSubScene();
        }
        startSubscene.moveSubScene();
        sceneToHide = startSubscene;
    }

    /**
     * Create subscenes.
     */
    // SubScenes werden an Buttons übergeben
    private void createSubscenes() {
        createContent();
        createHelp();
        createScore();
        createCredits();
    }

    /**
     * Create content.
     */
    //Erstellt die Subszene für die Startmenü-tabs
    void createContent() {
        VBox box = new VBox(5,
                new StartMenuUI("SPIEL STARTEN", () -> startGame()),
                new StartMenuUI("SCORE", () -> showSubScene(scoreSubScene)),
                new StartMenuUI("HILFE", () -> showSubScene(helpSubScene)),
                new StartMenuUI("CREDITS", () -> showSubScene(creditsSubScene)),
                new StartMenuUI("SPIEL BEENDEN", () -> Platform.exit())
        );
        box.setBackground(new Background(new BackgroundFill(Color.web("black", 0.6), null, null)));
        box.setTranslateX(1150);
        box.setTranslateY(580);
        startRoot.getChildren().add(box);
    }

    /**
     * Create help.
     */
    // Hilfe-Tab mit Informationen wird definiert und initialisiert
    private void createHelp() {
        helpSubScene = new StartSubScene();
        startRoot.getChildren().add(helpSubScene);
        startMenuUI.createHelpContent(helpSubScene);
    }

    /**
     * Create score.
     */
    //Score-Tab wird initialisiert
    void createScore() {
        scoreSubScene = new StartSubScene();
        startRoot.getChildren().add(scoreSubScene);
        startMenuUI.createScoreContent(scoreSubScene);
    }

    /**
     * Create credits.
     */
    //Credit-Tab wird initialisiert
    void createCredits() {
        creditsSubScene = new StartSubScene();
        startRoot.getChildren().add(creditsSubScene);
        startMenuUI.createCreditContent(creditsSubScene);
    }

    /**
     * Gets start menu scene.
     *
     * @return the start menu scene
     */
    public Scene getStartMenuScene() {
        return startScene;
    }

    public Stage getStage() {
        return stage;
    }
}