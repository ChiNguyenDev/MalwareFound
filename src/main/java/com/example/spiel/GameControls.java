package com.example.spiel;

import javafx.scene.Scene;
import javafx.scene.input.KeyCode;
import javafx.scene.layout.Pane;
import javafx.stage.Stage;

//Diese Klasse kümmert sich um die User-Inputs
public class GameControls {
    private Pane root;
    private Scene scene;
    private OverlayUI overlayUI;
    private GameSounds gameSounds;
    private GameManager gameManager;
    private GameStats gameStats;
    private GameMenu gameMenu;
    private ObjectUI objectUI;

    //Konstruktor mit den nötigen Objekten
    GameControls(Pane root, Scene scene, OverlayUI overlayUI, GameSounds gameSounds,
                 GameManager gameManager, GameStats gameStats, GameMenu gameMenu, ObjectUI objectUI) {
        this.root = root;
        this.scene = scene;
        this.overlayUI = overlayUI;
        this.gameSounds = gameSounds;
        this.gameManager = gameManager;
        this.gameStats = gameStats;
        this.gameMenu = gameMenu;
        this.objectUI = objectUI;
    }

    //Diese Methode verarbeitet User-inputs
    void keys() {
        if (!gameStats.getDeathState()) {
            //Verarbeitet Mausklicks für Angriffe
            scene.setOnMousePressed(event -> {
                if (event.isPrimaryButtonDown()) {
                    gameManager.createAttack(event);
                    gameManager.rotateImageView(event, objectUI.getAttackView());
                }
            });

            scene.setOnMouseMoved(event -> {
                gameManager.rotateImageView(event, objectUI.getPlayerView());
            });

            scene.setOnKeyPressed(event -> {
                KeyCode keyCode = event.getCode();

                // Startet das Spiel mit R neu, wenn man gestorben ist
                if (keyCode == KeyCode.R && overlayUI.isGameOverTextVisible()) {
                    gameStats.resetGame();
                }
                // Pausiert das Spiel und zeigt das Menü an, wenn die ESC-Taste gedrückt wird
                if (keyCode == KeyCode.ESCAPE && !gameStats.getPaused() && !overlayUI.isGameOverTextVisible()) {
                    gameStats.setPaused(true);
                    gameMenu.showMenu();
                    gameSounds.pauseMusic();
                } else if ((keyCode == KeyCode.ESCAPE && gameStats.getPaused() && !overlayUI.isGameOverTextVisible())) {
                    // Setzt das Spiel fort beim zweiten Escape
                    gameMenu.resumeGame();
                }
            });
        }
    }
}
