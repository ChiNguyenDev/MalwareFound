package com.example.spiel;

import javafx.animation.FadeTransition;
import javafx.application.Platform;
import javafx.scene.Scene;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.layout.*;
import javafx.scene.paint.Color;
import javafx.scene.text.Font;
import javafx.scene.text.Text;
import javafx.stage.Stage;
import javafx.util.Duration;

import java.util.List;

public class StartMenu {
    private Pane startRoot;
    private Stage stage;
    private Main main;
    private Scene startScene;
    private GameSounds gameSounds;
    private OverlayUI overlayUI;
    private StartSubScene creditsSubScene;
    private StartSubScene scoreSubScene;
    private StartSubScene helpSubScene;
    private StartSubScene sceneToHide;

    public StartMenu(Stage stage, Main main) {
        this.stage = stage;
        this.main = main;
        gameSounds = new GameSounds();
        sceneToHide = new StartSubScene();
        startMenu();

    }

    void startMenu() {
        gameSounds.playStartMusic();
        Pane startBackGroundRoot = new Pane(); // Root für den Hintergrund
        startRoot = new Pane(); // Root für alle anderen Objekte im Startmenue
        StackPane startGroup = new StackPane(startBackGroundRoot, startRoot);
        startScene = new Scene(startGroup);
        overlayUI = new OverlayUI(startBackGroundRoot, startRoot);
        overlayUI.addStartBackground();
        createSubscenes();

        stage.setScene(startScene);
    }

    private void startGame() {
        gameSounds.stopStartMusic();

        // Fade Effekt beim Starten des Spiel
        FadeTransition fadeOut = new FadeTransition(Duration.millis(500), startRoot);
        fadeOut.setFromValue(1.0);
        fadeOut.setToValue(0.0);
        fadeOut.setOnFinished(event -> {
            main.startGame();
        });

        fadeOut.play();
    }

    public Scene getStartMenuScene() {
        return startScene;
    }

    private void showSubScene(StartSubScene startSubscene) {
        if (sceneToHide != null) {
            sceneToHide.moveSubScene();
        }
        startSubscene.moveSubScene();
        sceneToHide = startSubscene;
    }

    // Subscenen werden an Buttons übergeben
    private void createSubscenes() {
        createContent();
        createHelp();
        createScore();
        createCredits();
    }

    //Erstellt die Subszene fuer die Startmenue-tabs
    void createContent() {
        VBox box = new VBox(5,
                new StartMenuUI("SPIEL STARTEN", () -> startGame()),
                new StartMenuUI("SCORE", () -> showSubScene(scoreSubScene)),
                new StartMenuUI("HILFE", () -> showSubScene(helpSubScene)),
                new StartMenuUI("CREDITS", () -> showSubScene(creditsSubScene)),
                new StartMenuUI("SPIEL BEENDEN", () -> Platform.exit())
        );
        box.setBackground(new Background(new BackgroundFill(Color.web("black", 0.6), null, null)));
        box.setTranslateX(1150);
        box.setTranslateY(580);
        startRoot.getChildren().add(box);
    }

    // Hilfe-Tab mit Informationen wird definiert und initialisiert
    private void createHelp() {
        helpSubScene = new StartSubScene();
        startRoot.getChildren().add(helpSubScene);
        overlayUI.createHelpContent(helpSubScene);
    }

    void createScore() {
        scoreSubScene = new StartSubScene();
        startRoot.getChildren().add(scoreSubScene);
        overlayUI.createScoreContent(scoreSubScene);
    }

    void createCredits() {
        creditsSubScene = new StartSubScene();
        startRoot.getChildren().add(creditsSubScene);
        overlayUI.createCreditContent(creditsSubScene);
    }
}